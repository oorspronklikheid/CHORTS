<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title> CHORTS</title>
</head>
<style type="text/css">
	
<style type="text/css">
	* { margin: 0; padding: 0;}

	body, html { height:99%;  width:99%; }


</style>
<body   >
<svg id='svgy' width='100%' height='100%'>
	<rect x="10" y="10" rx="15" ry="15" width=99% height=99% style="fill:#80200010;stroke:#70707000;stroke-width:0.5;opacity:1" />'

</svg>
</body>
<script type="text/javascript">

let balls = []

let svgy = document.getElementById('svgy')

let t = 0 
let id =0 
function loop() 
{
	t += 1

	if( t%30 == 0 )
	{
		console.log('pushing?')
		let y = Math.random()*50 + 100 // + Math.sin(t/600)*300 + 300
		// console.log(y)
		balls.push( {x:900 , y:y , id:id , dy:0 , mode:'normal' , progress:0 ,opacity:100})
		id ++ ;
		// console.log(balls)
	}

	let inner = '' 

	inner += '<rect x="10" y="10" rx="15" ry="15" width=99% height=99% style="fill:#80200010;stroke:#70707000;stroke-width:0.5;opacity:1" />'

	if(balls.length>0)
	{
		if(balls[0].x<10 )
			balls.shift()
	}
	for (var i = 1; i < balls.length; i++) {
		if(balls[i].x < 600)
			if(balls[i].id%2==0 && balls[i].mode != 'delete')
			{
				balls[i-1].dy += (balls[i].y - balls[i-1].y)/2
				balls[i+1].dy -= (balls[i+1].y - balls[i].y)/2

				balls[i].dy += ((balls[i+1].dy+balls[i+1].y) - (balls[i-1].y+balls[i-1].dy))/2 - balls[i].dy
				balls[i].mode = 'delete'
				// balls.splice(i, 1);

			}
		if(balls[i].x < 300)
			if(((balls[i].id-1)/2)%2==0 && balls[i].mode != 'delete')
			{

				balls[i-1].dy += (balls[i].y - balls[i-1].y)/2
				balls[i+1].dy -= (balls[i+1].y - balls[i].y)/2
				balls[i].mode = 'delete'
				balls.splice(i, 1);
			}

		if(balls[i].x < 150)
			if(((balls[i].id+1)/4)%2==0 && balls[i].mode != 'delete')
			{

				balls[i-1].dy += (balls[i].y - balls[i-1].y)/2
				balls[i+1].dy -= (balls[i+1].y - balls[i].y)/2
				balls[i].mode = 'delete'
				balls.splice(i, 1);
			}

	}

	inner += '<line x1="600" y1="0" x2="600" y2="1000" style="stroke:#aaa8;stroke-width:1" />'
	inner += '<line x1="300" y1="0" x2="300" y2="1000" style="stroke:#aaa8;stroke-width:1" />'
	inner += '<line x1="150" y1="0" x2="150" y2="1000" style="stroke:#aaa8;stroke-width:1" />'

	for (var i = 0; i < balls.length; i++) {
		balls[i].x -= (balls[i].x*balls[i].x*balls[i].x)/100000000  +0.1

		if(balls[i].mode == 'delete')
		{
			if(balls[i].progress < 100 )
			{
				balls[i].progress += 1; 
				balls[i].opacity = 117 - balls[i].progress

			}else
			{
				balls.splice(i, 1)
			}
		}

		if(balls[i].dy > 0.4)
		{
			balls[i].y += 0.4	
			balls[i].dy-= 0.4
		}
		if(balls[i].dy < -0.4)
		{
			balls[i].y -= 0.4		
			balls[i].dy+= 0.4
		}
		if(balls[i].dy != 0 && balls[i].dy  <0.4 && balls[i].dy > -0.4 )
		{
			balls[i].y += balls[i].dy		
			balls[i].dy= 0
		}

	}

	for (var i = 1; i < balls.length; i++) {
		inner += '<line x1="' + (balls[i-1].x -2.5) + '" y1="' + (balls[i-1].y -2.5) + '" x2="' + (balls[i].x -2.5) + '" y2="' + (balls[i].y  -2.5)+ '" style="stroke:rgb(200,60,50);stroke-width:2" />'
	}

	for (var i = 0; i < balls.length; i++) {
		inner += '<circle cx="' + balls[i].x + '" cy="' + balls[i].y + '" r="' + 5 + '" stroke="#eeeeeeff" stroke-width="2" fill="#440088' + balls[i].opacity.toString(16) + '" />'
		inner += '<text x="' + balls[i].x + '" y="' + balls[i].y + '" >' + balls[i].id+  '</text>'
		//'( ' + balls[i].dy + ' )' +
	}
	// console.log(balls[0].x)


	svgy.innerHTML = inner;
}


setInterval(loop, 1000/60);
	
</script>
</html>
